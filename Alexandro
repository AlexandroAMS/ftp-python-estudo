from ftplib import FTP, error_perm
import socket

def validar_ip(ip):
    try:
        socket.inet_aton(ip)
        return True
    except socket.error:
        return False


def conectar_ftp():
    host = input("Digite o IP do servidor FTP: ").strip()

    if not validar_ip(host):
        print("IP inv치lido.")
        return None

    usuario = input("Usu치rio: ").strip()
    senha = input("Senha: ").strip()

    try:
        ftp = FTP(host, timeout=10)
        print("\nConectado com sucesso!")
        print(ftp.getwelcome())

        ftp.login(usuario, senha)
        print("Login realizado com sucesso!\n")

        return ftp

    except error_perm:
        print("Erro: usu치rio ou senha inv치lidos.")
    except Exception as e:
        print("Erro ao conectar:", e)

    return None


def listar_arquivos(ftp):
    print("\n游늭 Listagem de arquivos:")
    ftp.retrlines("LIST")


def listar_nomes_simples(ftp):
    print("\n游늯 Arquivos (lista simples):")
    arquivos = ftp.nlst()
    for a in arquivos:
        print(a)


def mudar_diretorio(ftp):
    pasta = input("Digite o caminho do diret칩rio: ").strip()
    try:
        ftp.cwd(pasta)
        print("Diret칩rio atual:", ftp.pwd())
    except error_perm:
        print("Erro: diret칩rio n칚o encontrado ou sem permiss칚o.")


def download_arquivo(ftp):
    nome = input("Digite o nome do arquivo para download: ").strip()
    try:
        with open(nome, "wb") as f:
            ftp.retrbinary(f"RETR {nome}", f.write)
        print("Download conclu칤do:", nome)
    except Exception as e:
        print("Erro no download:", e)


def upload_arquivo(ftp):
    nome = input("Digite o nome do arquivo para upload: ").strip()
    try:
        with open(nome, "rb") as f:
            ftp.storbinary(f"STOR {nome}", f)
        print("Upload conclu칤do:", nome)
    except FileNotFoundError:
        print("Arquivo n칚o encontrado no computador.")
    except Exception as e:
        print("Erro no upload:", e)


def menu():
    print("""
========= MENU FTP =========
1 - Listar arquivos (detalhado)
2 - Listar arquivos (simples)
3 - Mudar diret칩rio
4 - Download de arquivo
5 - Upload de arquivo
6 - Mostrar diret칩rio atual
0 - Sair
============================
""")


def main():
    ftp = conectar_ftp()
    if not ftp:
        return

    while True:
        menu()
        opcao = input("Escolha uma op칞칚o: ").strip()

        if opcao == "1":
            listar_arquivos(ftp)

        elif opcao == "2":
            listar_nomes_simples(ftp)

        elif opcao == "3":
            mudar_diretorio(ftp)

        elif opcao == "4":
            download_arquivo(ftp)

        elif opcao == "5":
            upload_arquivo(ftp)

        elif opcao == "6":
            print("Diret칩rio atual:", ftp.pwd())

        elif opcao == "0":
            print("Encerrando conex칚o...")
            ftp.quit()
            break

        else:
            print("Op칞칚o inv치lida. Tente novamente.")


if __name__ == "__main__":
    main()
